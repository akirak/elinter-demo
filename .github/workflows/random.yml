name: 'Random'
on:
  schedule:
    - cron: '0 19 * * *'
  push:
    branches:
    - 'random-*'
jobs:
  lint:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        percentage:
          - 75
    steps:
    # Install Nix
    - uses: cachix/install-nix-action@v10
    - name: Set up binary cache
      run: nix-env -iA cachix -f https://cachix.org/api/v1/install && cachix use emacs-ci

    # Install and configure elinter
    - name: Install elinter
      run: nix-env -if https://github.com/akirak/elinter/archive/v4.tar.gz -A main
    - name: Configure elinter
      run: |
        # Set the linters and the Emacs version used for linting
        echo "::set-env name=ELINTER_LINTERS::checkdoc check-declare package-lint melpazoid"
        echo "::set-env NAME=EMACS_VERSION::27.1"

    - uses: actions/checkout@v2

    - name: Pick a random package
      run: ./random
      env:
        MELPA_TOP_PERCENTAGE_BOUND: ${{ matrix.percentage }}

    - name: Run lint on the package
      run: elinter -r ${RECIPE_FILE}
